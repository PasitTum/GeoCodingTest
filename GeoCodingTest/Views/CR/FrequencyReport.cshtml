@model GeoCodingTest.Models.L1.mWGE

@Html.Raw(TempData["msg"])

<!-- jQuery UI CSS Reference -->
<link href="@Url.Content("~/Content/themes/base/minified/jquery-ui.min.css")" rel="stylesheet" />
<!-- Required jQuery and jQuery UI Javascript references -->
<script src="@Url.Content("~/Scripts/jquery-1.7.1.min.js")"></script>
<script src="@Url.Content("~/Scripts/jquery-ui-1.10.4.min.js")"></script>
<!-- Code to wire up your DatePicker -->
<script type="text/javascript">
    $(function () {
        // This should targe the element generated by your EditorFor() Helper
        $('#CreatedOn').datepicker();
    })

    function calculateresult() { //โชว์ผลลัพธ์ล่างตาราง

        sumtotal1 = 0;
        sumtotal2 = 0;
        sumtotal3 = 0;
        sumtotal4 = 0;
        sumtotal5 = 0;

        avgtotal1 = 0;
        avgtotal2 = 0;
        avgtotal3 = 0;
        avgtotal4 = 0;
        avgtotal5 = 0;

        countavg = 0;

        var grid = document.getElementById("odgvData");
        var jvalue1 = grid.getElementsByClassName("job1");
        var jvalue2 = grid.getElementsByClassName("job2");
        var jvalue3 = grid.getElementsByClassName("job3");
        var jvalue4 = grid.getElementsByClassName("job4");
        var jvalue5 = grid.getElementsByClassName("job5");
        var dowvalue = grid.getElementsByClassName("dow");

        for (var c = 0; c < jvalue1.length; c++) {

            if (dowvalue[c].innerText != 'Saturday' && dowvalue[c].innerText != 'Sunday') {
                sumtotal1 += parseFloat(jvalue1[c].innerText);
                sumtotal2 += parseFloat(jvalue2[c].innerText);
                sumtotal3 += parseFloat(jvalue3[c].innerText);
                sumtotal4 += parseFloat(jvalue4[c].innerText);
                sumtotal5 += parseFloat(jvalue5[c].innerText);

                countavg++;
            }           
        }

        document.getElementById("total1").innerText = sumtotal1;
        document.getElementById("total2").innerText = sumtotal2;
        document.getElementById("total3").innerText = sumtotal3;
        document.getElementById("total4").innerText = sumtotal4;
        document.getElementById("total5").innerText = sumtotal5;

        //-------------------------------------------------------------

        //let countj = jvalue1.length; //หาค่าเฉลี่ย

        avgtotal1 = sumtotal1 / countavg;
        avgtotal2 = sumtotal2 / countavg;
        avgtotal3 = sumtotal3 / countavg;
        avgtotal4 = sumtotal4 / countavg;
        avgtotal5 = sumtotal5 / countavg;

        document.getElementById("avgtotal1").innerText = avgtotal1.toFixed(2);
        document.getElementById("avgtotal2").innerText = avgtotal2.toFixed(2);
        document.getElementById("avgtotal3").innerText = avgtotal3.toFixed(2);
        document.getElementById("avgtotal4").innerText = avgtotal4.toFixed(2);
        document.getElementById("avgtotal5").innerText = avgtotal5.toFixed(2);
    }

</script>

<body onload="calculateresult();">
    <div class="row">
        <div class="col-sm-12">

            <div class="box box-danger">
                <div class="box-header with-border">
                    <h3 class="box-title">รายงานความถี่</h3>

                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                    </div>
                </div>

                <div class="box-body table-responsive no-padding">

                    @using (Html.BeginForm("FrequencyReport"
                                         , "CR"
                                         , FormMethod.Post
                                         , new { id = "oForm" }))
                    {
                        <div class="form-group">
                            <label class="control-label col-sm-4" for="CreatedOn">เลือกเดือน :</label>
                            <div class="col-sm-12">
                                <input class="text-box single-line" data-val="true" data-val-date="The field CreatedOn must be a date." data-val-required="The CreatedOn field is required." id="CreatedOn" name="DateFrom" required type="month" value="" />
                                <span class="field-validation-valid" data-valmsg-for="CreatedOn" data-valmsg-replace="true"></span>
                            </div>
                        </div>
                        <div style="padding-left:15px;">
                            <button type="submit" class="btn btn-info ">Submit</button>
                        </div>
                        <br />
                    }

                    @if (Model != null && Model.ListBilling != null && Model.ListBilling.Count > 0)
                    {
                        <div>
                            <h4>Month - @Model.ListSetting[0].MonthName @Model.ListSetting[0].Year</h4>
                        </div>

                        <div class="box-footer table-responsive no-padding">

                            <table id="odgvData" class="table table-bordered table-hover dataTable" role="grid" aria-describedby="example2_info">
                                <thead>
                                    <tr role="row">
                                        <th>วันที่</th>
                                        <th>DayOfWeek</th>

                                        @*@foreach (var oItem in Model.ListSetting)
                                            {
                                                <th>@oItem.Name</th>
                                            }*@

                                        <th>Sompong Montien</th>
                                        <th>Patcharin Piroonsup</th>
                                        <th>Maetee Jundang</th>
                                        <th>Chairat Kanha</th>
                                        <th>Sommai Detphutsa</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (Model != null && Model.ListBilling != null && Model.ListBilling.Count > 0)
                                    {
                                        int[] a = new int[32];
                                        int[] b = new int[32];
                                        int[] c = new int[32];
                                        int[] d = new int[32];
                                        int[] e = new int[32];

                                        int dow = Model.ListSetting[0].DayofWeek;
                                        string[] dayofweek = { "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday" };


                                        foreach (var item in Model.ListBilling)
                                        {
                                            int date = item.SubmitDate.Value.Day;

                                            if (item.Name == "Sompong Montien")
                                            {
                                                a[date] += 1;
                                            }
                                            else if (item.Name == "Patcharin Piroonsup")
                                            {
                                                b[date] += 1;
                                            }
                                            else if (item.Name == "Maetee Jundang")
                                            {
                                                c[date] += 1;
                                            }
                                            else if (item.Name == "Chairat Kanha")
                                            {
                                                d[date] += 1;
                                            }
                                            else if (item.Name == "Sommai Detphutsa")
                                            {
                                                e[date] += 1;
                                            }
                                            else
                                            {

                                            }
                                        }

                                        for (int j = 1; j < Model.ListSetting[0].Days + 1; j++)
                                        {
                                            <tr>
                                                <td>@j</td>
                                                <td class="dow">@dayofweek[dow]</td>
                                                <td class="job1">@a[j]</td>
                                                <td class="job2">@b[j]</td>
                                                <td class="job3">@c[j]</td>
                                                <td class="job4">@d[j]</td>
                                                <td class="job5">@e[j]</td>
                                            </tr>

                                            dow++;

                                            if(dow == 7)
                                            {
                                                dow = 0;
                                            }
                                        }

                                    }
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="2" align="center"><b>Total</b></td>
                                        <td id="total1"></td>
                                        <td id="total2"></td>
                                        <td id="total3"></td>
                                        <td id="total4"></td>
                                        <td id="total5"></td>
                                    </tr>
                                    <tr>
                                        <td colspan="2" align="center"><b>Average</b></td>
                                        <td id="avgtotal1"></td>
                                        <td id="avgtotal2"></td>
                                        <td id="avgtotal3"></td>
                                        <td id="avgtotal4"></td>
                                        <td id="avgtotal5"></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</body>

@section scripts{

    <link rel="stylesheet" href="~/Content/adminlte/bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css">
    <script type="text/javascript" src="~/Content/adminlte/bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="~/Content/adminlte/bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>

    @*Gridview*@
    <script type="text/javascript">
        $(document).ready(function () {
            $('#odgvData').DataTable({
                'paging': false,
                'lengthChange': false,
                'searching': true,
                'ordering': true,
                'info': true,
                'autoWidth': false,
                language: {
                    "zeroRecords": "ไม่มีข้อมูล"
                },
                "iDisplayLength": 25
            });

            $('#Paginator').on('click', 'a', function (even) {

                var tPage = this.search;

                if (tPage == "")
                    return false;

                tPage = tPage.replace("?", "");
                tPage = tPage.split("&")[0].replace("page=", "");
                $("#Page").val(tPage);
                $("#obtnSearch").click();

                //var radioValue = $("input[name='XVScanType']:checked").val();
                //pmdoData = {
                //    XVScanType: radioValue,
                //    XVSearch: $("#XVSearch").val(),
                //}

                //$.ajax({
                //    url: this.href,
                //    type: 'POST',
                //    data: pmdoData,
                //    cache: false,
                //    async: true,
                //    error: function (jqXHR, error, errorThrown) {
                //        //display error
                //    },
                //    success: function (data, textStatus, jqXHR) {
                //        $("body").html(data);
                //    }
                //});
                return false;
            });
        });
    </script>
}

